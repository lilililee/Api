!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Api=t()}(this,function(){"use strict";var e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},t="undefined"!=typeof console;var n=function(e,t){return Object.keys(e).forEach(function(n){return t[n]=e[n]})},o=function(e){return/\?/.test(e)?"&":"?"},r=document.getElementsByTagName("head")[0];function i(e){window[e]=void 0}function a(e){r.removeChild(document.getElementById(e))}function u(e){var n=e.href,u=e.timeout,c=e.callbackName,s=e.callbackId||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),f=""+n+o(n)+c+"="+s;return new Promise(function(e,n){var o,c,d,l=setTimeout(function(){!function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.error.apply(console,e)}("JSONP request to "+f+" timed out"),n(f),i(s),a(s)},u);window[s]=function(t){e(t),l&&clearTimeout(l),i(s),a(s)},o=s,c=f,(d=document.createElement("script")).id=o,d.setAttribute("src",c),r.appendChild(d)})}function c(e){var t=e.url,n=e.search,o=e.input,r=e.dataType,i=e.methods,a=e.async,u=e.withCredentials,c=e.header,s=e.timeout,f=e.xhrEvent,d=new XMLHttpRequest;return new Promise(function(e,l){var p,h,m,y,v="json"===r?n.slice(1):(p=o,h=new FormData,Object.keys(p).forEach(function(e){return h.append(e,p[e])}),h);d.withCredentials=u,d.timeout=s,d.open(i,t,a),function(e,t){for(var n in t)e.setRequestHeader(n,t[n])}(d,c),d.send(v),m=d,y=f,Object.keys(y).forEach(function(e){m.addEventListener(e,y[e])}),"function"==typeof y.uploadProgress&&m.upload&&m.upload.addEventListener("progress",y.uploadProgress),d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var t=d.response;"object"!=typeof t&&(t=JSON.parse(t)),e(t)}else l(d)}})}var s=/^([a-z][a-z\d\+\-\.]*:)?\/\//i,f={domain:window.location.href,methods:"GET",dataType:"json",timeout:1e4,useMock:!1,input:{},mock:{},callbackName:"callback",callbackId:0,withCredentials:!1,urlModel:0,debug:!1,async:!0,filter:function(e){return e},header:{},xhrEvent:{}},d=function(){function e(e){this.mixins(e)}return e.prototype.mixins=function(e){n(e,this)},Object.defineProperty(e.prototype,"href",{get:function(){return this.url+this.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return o(this.url)+(e=this.filter(this.input),Object.keys(e).map(function(t){return t+"="+e[t]}).join("&"));var e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){var e=this.urlModel,t=this.domain,n=this.namespace;return 1===e?t:s.test(n)?n:t+n},enumerable:!0,configurable:!0}),e.prototype.send=function(){return this.debug&&function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.log.apply(console,e)}(""+this.namespace,this.input),this.useMock?Promise.resolve(this.mock):"jsonp"===this.dataType?u(this):c(this)},e}(),l={},p={};return{define:function(e,n){void 0===n&&(n={}),l[e]&&function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.warn.apply(console,e)}("redefine "+e),l[e]=new d(n)},config:function(e){void 0===e&&(e={}),n(e,p)},require:function(t,n,o){void 0===n&&(n={}),void 0===o&&(o={}),l[t]||this.define(t);var r=l[t];return r.mixins(e({},f,p,r,o,{namespace:t,input:n})),r.send()},get:function(e){return l[e]}}});
